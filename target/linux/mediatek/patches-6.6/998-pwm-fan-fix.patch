From 9f08ee7f19ed8ab3f749810535a3f07d82ab41fe Mon Sep 17 00:00:00 2001
From: gfuzan <gfuzan@163.com>
Date: Tue, 29 Jul 2025 22:21:21 +0800

diff --git a/drivers/hwmon/pwm-fan.c b/drivers/hwmon/pwm-fan.c
index b67bc9e833c0..614b675c0de2 100644
--- a/drivers/hwmon/pwm-fan.c
+++ b/drivers/hwmon/pwm-fan.c
@@ -50,6 +50,7 @@
 	struct pwm_fan_tach *tachs;
 	ktime_t sample_start;
 	struct timer_list rpm_timer;
+	struct timer_list init_timer;
 
 	unsigned int pwm_value;
 	unsigned int pwm_fan_state;
@@ -474,7 +475,6 @@
 
 static int pwm_fan_probe(struct platform_device *pdev)
 {
-	struct thermal_cooling_device *cdev;
 	struct device *dev = &pdev->dev;
 	struct pwm_fan_ctx *ctx;
 	struct device *hwmon;
@@ -627,19 +627,7 @@
 		return ret;
 
 	ctx->pwm_fan_state = ctx->pwm_fan_max_state;
-	if (IS_ENABLED(CONFIG_THERMAL)) {
-		cdev = devm_thermal_of_cooling_device_register(dev,
-			dev->of_node, "pwm-fan", ctx, &pwm_fan_cooling_ops);
-		if (IS_ERR(cdev)) {
-			ret = PTR_ERR(cdev);
-			dev_err(dev,
-				"Failed to register pwm-fan as cooling device: %d\n",
-				ret);
-			return ret;
-		}
-		ctx->cdev = cdev;
-	}
-
+	set_pwm(ctx, 0);
 	return 0;
 }
 
